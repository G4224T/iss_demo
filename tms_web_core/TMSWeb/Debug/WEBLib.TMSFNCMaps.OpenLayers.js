rtl.module("WEBLib.TMSFNCMaps.OpenLayers",["System"],function () {
  "use strict";
  var $mod = this;
  var $impl = $mod.$impl;
  this.OPENLAYERSAPIVERSION = "v8.1.0";
  this.OPENLAYERSAPIURL = "https://cdn.jsdelivr.net/npm/ol@";
  this.MAPSERVICEVAR = "window.ol";
  this.MAPSOURCEVAR = ".source.OSM()";
  this.CLUSTERVAR = "cluster";
  this.CLUSTERARRAYVAR = "clusterarray";
  this.GETCLUSTERARRAYVAR = "get" + this.CLUSTERARRAYVAR + "()";
  this.ADDORUPDATECLUSTERFUNCTION = "addOrUpdateCluster";
  this.DELETECLUSTERFUNCTION = "deleteCluster";
  this.RegisterOpenLayersService = function () {
    if (!pas["WEBLib.TMSFNCMaps"].TTMSFNCMapsPlatformServices.Current().SupportsPlatformService$1(rtl.getIntfGUIDR(pas["WEBLib.TMSFNCMaps"].ITMSFNCMapsServiceOpenLayers),{p: $impl, get: function () {
        return this.p.MapsService;
      }, set: function (v) {
        rtl.setIntfP(this.p,"MapsService",v);
      }})) {
      rtl.setIntfP($impl,"MapsService",rtl.queryIntfT($impl.TTMSFNCMapsOpenLayersService.$create("Create$1"),pas["WEBLib.TMSFNCMaps"].ITMSFNCMapsServiceOpenLayers),true);
      pas["WEBLib.TMSFNCMaps"].TTMSFNCMapsPlatformServices.Current().AddPlatformService(rtl.getIntfGUIDR(pas["WEBLib.TMSFNCMaps"].ITMSFNCMapsServiceOpenLayers),$impl.MapsService);
    };
  };
  this.UnRegisterOpenLayersService = function () {
    pas["WEBLib.TMSFNCMaps"].TTMSFNCMapsPlatformServices.Current().RemovePlatformService(rtl.getIntfGUIDR(pas["WEBLib.TMSFNCMaps"].ITMSFNCMapsServiceOpenLayers));
  };
  $mod.$implcode = function () {
    $mod.$rtti.$Class("TTMSFNCMapsOpenLayersService");
    rtl.createClass($impl,"TTMSFNCMapsOpenLayersFactoryService",pas["WEBLib.TMSFNCMaps"].TTMSFNCMapsFactoryService,function () {
      rtl.addIntf(this,pas["WEBLib.TMSFNCMaps"].ITMSFNCMapsServiceOpenLayers);
      rtl.addIntf(this,pas["WEBLib.TMSFNCMaps"].ITMSFNCMapsService);
      rtl.addIntf(this,pas.System.IUnknown);
    });
    rtl.createClass($impl,"TTMSFNCMapsOpenLayersService",$impl.TTMSFNCMapsOpenLayersFactoryService,function () {
      this.DoCreateMaps = function () {
        var Result = null;
        var $ok = false;
        try {
          Result = rtl.setIntfL(Result,rtl.queryIntfT($impl.TTMSFNCMapsOpenLayers.$create("Create$1"),pas["WEBLib.TMSFNCMaps"].ITMSFNCCustomMaps),true);
          $ok = true;
        } finally {
          if (!$ok) rtl._Release(Result);
        };
        return Result;
      };
      rtl.addIntf(this,pas["WEBLib.TMSFNCMaps"].ITMSFNCMapsServiceOpenLayers);
      rtl.addIntf(this,pas["WEBLib.TMSFNCMaps"].ITMSFNCMapsService);
      rtl.addIntf(this,pas.System.IUnknown);
    });
    $mod.$rtti.$Class("TTMSFNCMapsOpenLayers");
    rtl.createClass($impl,"TTMSFNCMapsOpenLayers",pas["WEBLib.TMSFNCMaps"].TTMSFNCCustomMapsInterfacedObject,function () {
      this.GetHeadLinks = function (AList) {
        AList.Add$1(pas["WEBLib.TMSFNCMaps"].TTMSFNCMapsLink.$create("CreateLink",[$mod.OPENLAYERSAPIURL + $mod.OPENLAYERSAPIVERSION + "/ol.css","text/css","stylesheet"]));
        AList.Add$1(pas["WEBLib.TMSFNCMaps"].TTMSFNCMapsLink.$create("CreateScript",[$mod.OPENLAYERSAPIURL + $mod.OPENLAYERSAPIVERSION + "/dist/ol.js","text/javascript","","",false,false]));
      };
      this.RemoveScripts = function () {
        if (window.ol){
          window.ol = undefined;
        };
      };
      this.GetResetMap = function () {
        var Result = "";
        Result = "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".removeEventListener('moveend', ZoomChanged);";
        return Result;
      };
      this.GetShowPopup = function () {
        var Result = "";
        Result = "  var lnlt = " + $mod.MAPSERVICEVAR + ".proj.fromLonLat([" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Longitude"], ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Latitude"]]);' + pas["WEBLib.TMSFNCMaps"].LB + "  var el = document.createElement('div');" + pas["WEBLib.TMSFNCMaps"].LB + "  var t = " + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Text"];' + pas["WEBLib.TMSFNCMaps"].LB + '  el.className = "ol-popup"' + pas["WEBLib.TMSFNCMaps"].LB + '  el.innerHTML = \'<a href="#" id="popup-closer-popup" class="ol-popup-closer"></a><div>\' + t + \'</div>\'' + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].POPUPVAR + " = new " + $mod.MAPSERVICEVAR + ".Overlay({element: el, autoPan: " + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["PanMap"], offset: [' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["OffsetX"], ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["OffsetY"]]});' + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].POPUPVAR + ".setPosition(lnlt);" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".addOverlay(" + pas["WEBLib.TMSFNCMaps"].POPUPVAR + ");" + pas["WEBLib.TMSFNCMaps"].LB + "          var closer = document.getElementById('popup-closer-popup');" + pas["WEBLib.TMSFNCMaps"].LB + "          closer.onclick = function() {" + pas["WEBLib.TMSFNCMaps"].LB + "            " + pas["WEBLib.TMSFNCMaps"].POPUPVAR + ".setPosition(undefined);" + pas["WEBLib.TMSFNCMaps"].LB + "            " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".removeOverlay(" + pas["WEBLib.TMSFNCMaps"].POPUPVAR + ");" + pas["WEBLib.TMSFNCMaps"].LB + "            " + pas["WEBLib.TMSFNCMaps"].POPUPVAR + " = null;" + pas["WEBLib.TMSFNCMaps"].LB + "            closer.blur();" + pas["WEBLib.TMSFNCMaps"].LB + "            return false;" + pas["WEBLib.TMSFNCMaps"].LB + "          };";
        return Result;
      };
      this.GetClosePopup = function () {
        var Result = "";
        Result = "  " + pas["WEBLib.TMSFNCMaps"].POPUPVAR + ".setPosition(undefined);" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".removeOverlay(" + pas["WEBLib.TMSFNCMaps"].POPUPVAR + ");" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].POPUPVAR + " = null;";
        return Result;
      };
      this.GetHeadStyle = function () {
        var Result = "";
        Result = ".ol-popup {" + pas["WEBLib.TMSFNCMaps"].LB + "  position: absolute;" + pas["WEBLib.TMSFNCMaps"].LB + "  background-color: white;" + pas["WEBLib.TMSFNCMaps"].LB + "  box-shadow: 0 1px 4px rgba(0,0,0,0.2);" + pas["WEBLib.TMSFNCMaps"].LB + "  padding: 15px;" + pas["WEBLib.TMSFNCMaps"].LB + "  border-radius: 10px;" + pas["WEBLib.TMSFNCMaps"].LB + "  border: 1px solid #cccccc;" + pas["WEBLib.TMSFNCMaps"].LB + "  bottom: 12px;" + pas["WEBLib.TMSFNCMaps"].LB + "  left: -50px;" + pas["WEBLib.TMSFNCMaps"].LB + "  min-width: 100px;" + pas["WEBLib.TMSFNCMaps"].LB + "}" + pas["WEBLib.TMSFNCMaps"].LB + ".ol-popup:after, .ol-popup:before {" + pas["WEBLib.TMSFNCMaps"].LB + "  top: 100%;" + pas["WEBLib.TMSFNCMaps"].LB + "  border: solid transparent;" + pas["WEBLib.TMSFNCMaps"].LB + '  content: " ";' + pas["WEBLib.TMSFNCMaps"].LB + "  height: 0;" + pas["WEBLib.TMSFNCMaps"].LB + "  width: 0;" + pas["WEBLib.TMSFNCMaps"].LB + "  position: absolute;" + pas["WEBLib.TMSFNCMaps"].LB + "  pointer-events: none;" + pas["WEBLib.TMSFNCMaps"].LB + "}" + pas["WEBLib.TMSFNCMaps"].LB + ".ol-popup:after {" + pas["WEBLib.TMSFNCMaps"].LB + "  border-top-color: white;" + pas["WEBLib.TMSFNCMaps"].LB + "  border-width: 10px;" + pas["WEBLib.TMSFNCMaps"].LB + "  left: 48px;" + pas["WEBLib.TMSFNCMaps"].LB + "  margin-left: -10px;" + pas["WEBLib.TMSFNCMaps"].LB + "}" + pas["WEBLib.TMSFNCMaps"].LB + ".ol-popup:before {" + pas["WEBLib.TMSFNCMaps"].LB + "  border-top-color: #cccccc;" + pas["WEBLib.TMSFNCMaps"].LB + "  border-width: 11px;" + pas["WEBLib.TMSFNCMaps"].LB + "  left: 48px;" + pas["WEBLib.TMSFNCMaps"].LB + "  margin-left: -11px;" + pas["WEBLib.TMSFNCMaps"].LB + "}" + pas["WEBLib.TMSFNCMaps"].LB + ".ol-popup-closer {" + pas["WEBLib.TMSFNCMaps"].LB + "  text-decoration: none;" + pas["WEBLib.TMSFNCMaps"].LB + "  position: absolute;" + pas["WEBLib.TMSFNCMaps"].LB + "  top: 2px;" + pas["WEBLib.TMSFNCMaps"].LB + "  right: 8px;" + pas["WEBLib.TMSFNCMaps"].LB + "}" + pas["WEBLib.TMSFNCMaps"].LB + ".ol-popup-closer:after {" + pas["WEBLib.TMSFNCMaps"].LB + '  content: "âœ–";' + pas["WEBLib.TMSFNCMaps"].LB + "}";
        return Result;
      };
      this.GetDelayLoadEvent = function () {
        var Result = "";
        Result = "";
        return Result;
      };
      this.GetMapsServiceCheck = function () {
        var Result = "";
        Result = "!" + $mod.MAPSERVICEVAR;
        return Result;
      };
      this.GetIdentifier = function () {
        var Result = "";
        Result = "OpenLayers";
        return Result;
      };
      this.GetInitializeMap = function () {
        var Result = "";
        var $ir = rtl.createIntfRefs();
        try {
          Result = "  var int;" + pas["WEBLib.TMSFNCMaps"].LB + "  " + $impl.MAPDOUBLECLICK + " = new " + $mod.MAPSERVICEVAR + ".interaction.DoubleClickZoom();" + pas["WEBLib.TMSFNCMaps"].LB + "  " + $impl.MAPPANNING + " = new " + $mod.MAPSERVICEVAR + ".interaction.DragPan();" + pas["WEBLib.TMSFNCMaps"].LB + "  " + $impl.MAPWHEELZOOM + " = new " + $mod.MAPSERVICEVAR + ".interaction.MouseWheelZoom();" + pas["WEBLib.TMSFNCMaps"].LB;
          Result = Result + "  int = " + $mod.MAPSERVICEVAR + ".interaction.defaults.defaults({doubleClickZoom: false, dragPan: false, mouseWheelZoom: false}).extend([" + $impl.MAPDOUBLECLICK + ", " + $impl.MAPPANNING + ", " + $impl.MAPWHEELZOOM + "])" + pas["WEBLib.TMSFNCMaps"].LB;
          Result = Result + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + " = new " + $mod.MAPSERVICEVAR + ".Map({" + pas["WEBLib.TMSFNCMaps"].LB + "    interactions: int," + pas["WEBLib.TMSFNCMaps"].LB + '    target: "' + pas["WEBLib.TMSFNCMaps"].MAPID + '",' + pas["WEBLib.TMSFNCMaps"].LB + "    layers: [" + pas["WEBLib.TMSFNCMaps"].LB + "      new " + $mod.MAPSERVICEVAR + ".layer.Tile({" + pas["WEBLib.TMSFNCMaps"].LB + "        source: new " + $mod.MAPSERVICEVAR + $mod.MAPSOURCEVAR + pas["WEBLib.TMSFNCMaps"].LB + "      })" + pas["WEBLib.TMSFNCMaps"].LB + "    ]," + pas["WEBLib.TMSFNCMaps"].LB + "    view: new " + $mod.MAPSERVICEVAR + ".View({" + pas["WEBLib.TMSFNCMaps"].LB + "      center: " + $mod.MAPSERVICEVAR + ".proj.fromLonLat([" + $ir.ref(1,this.GetMapsProperties()).GetDefaultLongitude() + ", " + $ir.ref(2,this.GetMapsProperties()).GetDefaultLatitude() + "])," + pas["WEBLib.TMSFNCMaps"].LB + "      zoom: " + $ir.ref(3,this.GetMapsProperties()).GetDefaultZoomLevel() + pas["WEBLib.TMSFNCMaps"].LB + "    })," + pas["WEBLib.TMSFNCMaps"].LB + "    controls:[]" + pas["WEBLib.TMSFNCMaps"].LB + "  });" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB;
          Result = Result + "  " + $impl.MAPZOOMCONTROLVAR + " = new " + $mod.MAPSERVICEVAR + ".control.Zoom();" + pas["WEBLib.TMSFNCMaps"].LB;
          if ($ir.ref(4,this.GetMapsProperties()).GetShowZoomControl()) {
            Result = Result + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".addControl(" + $impl.MAPZOOMCONTROLVAR + ");" + pas["WEBLib.TMSFNCMaps"].LB + "  " + $impl.MAPCONTROLARRAYVAR + ".push(" + $impl.MAPZOOMCONTROLVAR + ");" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB;
          };
          if (!$ir.ref(5,this.GetMapsProperties()).GetZoomOnDblClick()) {
            Result = Result + "  " + $impl.MAPDOUBLECLICK + ".setActive(false);" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB;
          } else {
            Result = Result + "  " + $impl.MAPDOUBLECLICK + ".setActive(true);" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB;
          };
          if (!$ir.ref(6,this.GetMapsProperties()).GetZoomOnWheelScroll()) {
            Result = Result + "  " + $impl.MAPWHEELZOOM + ".setActive(false);" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB;
          } else {
            Result = Result + "  " + $impl.MAPWHEELZOOM + ".setActive(true);" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB;
          };
          if (!$ir.ref(7,this.GetMapsProperties()).GetPanning()) {
            Result = Result + "  " + $impl.MAPPANNING + ".setActive(false);" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB;
          } else {
            Result = Result + "  " + $impl.MAPPANNING + ".setActive(true);" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB;
          };
        } finally {
          $ir.free();
        };
        return Result;
      };
      this.GetInitializeEvents = function () {
        var Result = "";
        Result = "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".addEventListener('moveend', ZoomChanged);" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".addEventListener('rendercomplete', MapRenderComplete);" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".un('movestart', MapMoveStart);" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".on('movestart', MapMoveStart);" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".un('moveend', MapMoveEnd);" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".on('moveend', MapMoveEnd);" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".un('click', MapClick);" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".on('click', MapClick);" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".un('dblclick', MapDblClick);" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".on('dblclick', MapDblClick);" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".un('pointerup', MapMouseUp);" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".on('pointerup', MapMouseUp);" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".un('pointerdown', MapMouseDown);" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".on('pointerdown', MapMouseDown);" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".un('pointermove', MapMouseMove);" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".on('pointermove', MapMouseMove);";
        return Result;
      };
      this.GetAddOrUpdateMarker = function () {
        var Result = "";
        Result = "  var lnlt = " + $mod.MAPSERVICEVAR + ".proj.fromLonLat([" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Longitude"], ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Latitude"]]);' + pas["WEBLib.TMSFNCMaps"].LB + "  var loc = new " + $mod.MAPSERVICEVAR + ".geom.Point(lnlt);" + pas["WEBLib.TMSFNCMaps"].LB + "  var iconStyle;" + pas["WEBLib.TMSFNCMaps"].LB + "  if (" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["IconURL"] != ""){' + pas["WEBLib.TMSFNCMaps"].LB + "    iconStyle = new " + $mod.MAPSERVICEVAR + ".style.Style({" + pas["WEBLib.TMSFNCMaps"].LB + "      image: new " + $mod.MAPSERVICEVAR + ".style.Icon(({" + pas["WEBLib.TMSFNCMaps"].LB + "          anchor: [0.5, 1]," + pas["WEBLib.TMSFNCMaps"].LB + "          src: " + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["IconURL"]' + pas["WEBLib.TMSFNCMaps"].LB + "      }))" + pas["WEBLib.TMSFNCMaps"].LB + "    });" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "  }" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "  if (!" + pas["WEBLib.TMSFNCMaps"].MARKERVAR + "){" + pas["WEBLib.TMSFNCMaps"].LB + "    var f = new " + $mod.MAPSERVICEVAR + ".Feature({" + pas["WEBLib.TMSFNCMaps"].LB + "      geometry: loc," + pas["WEBLib.TMSFNCMaps"].LB + "    })" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "    f.setId(" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["ID"].toString());' + pas["WEBLib.TMSFNCMaps"].LB + "    function getFeature(event){" + pas["WEBLib.TMSFNCMaps"].LB + "      var feature = " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".forEachFeatureAtPixel(event.pixel," + pas["WEBLib.TMSFNCMaps"].LB + "      function(ft) {" + pas["WEBLib.TMSFNCMaps"].LB + "        return ft;" + pas["WEBLib.TMSFNCMaps"].LB + "      }, {" + pas["WEBLib.TMSFNCMaps"].LB + "      layerFilter: function(layer) {" + pas["WEBLib.TMSFNCMaps"].LB + "        var foundlayer = false;" + pas["WEBLib.TMSFNCMaps"].LB + "        foundlayer = layer === " + pas["WEBLib.TMSFNCMaps"].MARKERVAR + ";" + pas["WEBLib.TMSFNCMaps"].LB + "        if (" + $mod.CLUSTERARRAYVAR + ") {" + pas["WEBLib.TMSFNCMaps"].LB + "        for (var key in " + $mod.CLUSTERARRAYVAR + ") {" + pas["WEBLib.TMSFNCMaps"].LB + "          if (" + $mod.CLUSTERARRAYVAR + ".hasOwnProperty(key)) {" + pas["WEBLib.TMSFNCMaps"].LB + "            if (layer === " + $mod.CLUSTERARRAYVAR + "[key])" + pas["WEBLib.TMSFNCMaps"].LB + "              foundlayer = true;" + pas["WEBLib.TMSFNCMaps"].LB + "          }" + pas["WEBLib.TMSFNCMaps"].LB + "        }" + pas["WEBLib.TMSFNCMaps"].LB + "        }" + pas["WEBLib.TMSFNCMaps"].LB + "        return foundlayer;" + pas["WEBLib.TMSFNCMaps"].LB + "      }});" + pas["WEBLib.TMSFNCMaps"].LB + "      if (feature) {" + '        clusterfeatures = feature.get("features"); ' + pas["WEBLib.TMSFNCMaps"].LB + "        if (clusterfeatures) {" + pas["WEBLib.TMSFNCMaps"].LB + "          if (clusterfeatures.length == 1){" + pas["WEBLib.TMSFNCMaps"].LB + "            if (clusterfeatures[0] === f)" + pas["WEBLib.TMSFNCMaps"].LB + "            feature = clusterfeatures[0];" + pas["WEBLib.TMSFNCMaps"].LB + "          }" + pas["WEBLib.TMSFNCMaps"].LB + "        }" + pas["WEBLib.TMSFNCMaps"].LB + "      }" + "      return feature;" + pas["WEBLib.TMSFNCMaps"].LB + "    }" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "    var MarkerPopup = null;" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "    var MarkerClick = function(event){" + pas["WEBLib.TMSFNCMaps"].LB + "      var ft = getFeature(event);" + pas["WEBLib.TMSFNCMaps"].LB + "      if (ft === f && !activeMarker) {" + pas["WEBLib.TMSFNCMaps"].LB + "        activeMarker = f;" + pas["WEBLib.TMSFNCMaps"].LB + "        if (" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Title"] != "" && !MarkerPopup){' + pas["WEBLib.TMSFNCMaps"].LB + "          var el = document.createElement('div');" + pas["WEBLib.TMSFNCMaps"].LB + "          var t = " + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Title"];' + pas["WEBLib.TMSFNCMaps"].LB + '          el.className = "ol-popup"' + pas["WEBLib.TMSFNCMaps"].LB + '          el.innerHTML = \'<a href="#" id="popup-closer-marker" class="ol-popup-closer"></a><div>\' + t + \'</div>\'' + pas["WEBLib.TMSFNCMaps"].LB + "          MarkerPopup = new " + $mod.MAPSERVICEVAR + ".Overlay({element: el, offset: [0, -50]});" + pas["WEBLib.TMSFNCMaps"].LB + "          MarkerPopup.setPosition(activeMarker.getGeometry().getCoordinates());" + pas["WEBLib.TMSFNCMaps"].LB + "          " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".addOverlay(MarkerPopup);" + pas["WEBLib.TMSFNCMaps"].LB + "          var closer = document.getElementById('popup-closer-marker');" + pas["WEBLib.TMSFNCMaps"].LB + "          closer.onclick = function() {" + pas["WEBLib.TMSFNCMaps"].LB + "            MarkerPopup.setPosition(undefined);" + pas["WEBLib.TMSFNCMaps"].LB + "            MarkerPopup = null;" + pas["WEBLib.TMSFNCMaps"].LB + "            closer.blur();" + pas["WEBLib.TMSFNCMaps"].LB + "            return false;" + pas["WEBLib.TMSFNCMaps"].LB + "          };" + pas["WEBLib.TMSFNCMaps"].LB + "        }" + pas["WEBLib.TMSFNCMaps"].LB + "        " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(event, "MarkerClick", ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["ID"]));' + pas["WEBLib.TMSFNCMaps"].LB + "      }" + pas["WEBLib.TMSFNCMaps"].LB + "    }" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".on('click', MarkerClick);" + pas["WEBLib.TMSFNCMaps"].LB + "    var MarkerDblClick = function(event){" + pas["WEBLib.TMSFNCMaps"].LB + "      var ft = getFeature(event);" + pas["WEBLib.TMSFNCMaps"].LB + "      if (ft === f && !activeMarker) {" + pas["WEBLib.TMSFNCMaps"].LB + "        activeMarker = f;" + pas["WEBLib.TMSFNCMaps"].LB + "        " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(event, "MarkerDblClick", ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["ID"]));' + pas["WEBLib.TMSFNCMaps"].LB + "      }" + pas["WEBLib.TMSFNCMaps"].LB + "    }" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".on('dblclick', MarkerDblClick);" + pas["WEBLib.TMSFNCMaps"].LB + "    var MarkerMouseUp = function(event){" + pas["WEBLib.TMSFNCMaps"].LB + "      var ft = getFeature(event);" + pas["WEBLib.TMSFNCMaps"].LB + "      if (ft === f && !activeMarker) {" + pas["WEBLib.TMSFNCMaps"].LB + "        activeMarker = f;" + pas["WEBLib.TMSFNCMaps"].LB + "        " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(event, "MarkerMouseUp", ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["ID"]));' + pas["WEBLib.TMSFNCMaps"].LB + "      }" + pas["WEBLib.TMSFNCMaps"].LB + "    }" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".on('pointerup', MarkerMouseUp);" + pas["WEBLib.TMSFNCMaps"].LB + "    var MarkerMouseDown = function(event){" + pas["WEBLib.TMSFNCMaps"].LB + "      var ft = getFeature(event);" + pas["WEBLib.TMSFNCMaps"].LB + "      if (ft === f && !activeMarker) {" + pas["WEBLib.TMSFNCMaps"].LB + "        activeMarker = f;" + pas["WEBLib.TMSFNCMaps"].LB + "        " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(event, "MarkerMouseDown", ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["ID"]));' + pas["WEBLib.TMSFNCMaps"].LB + "      }" + pas["WEBLib.TMSFNCMaps"].LB + "    }" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".on('pointerdown', MarkerMouseDown);" + pas["WEBLib.TMSFNCMaps"].LB + "    var MarkerMouseMove = function(event){" + pas["WEBLib.TMSFNCMaps"].LB + "      var ft = getFeature(event);" + pas["WEBLib.TMSFNCMaps"].LB + "      if (ft && ft === f && ft != hoverFeature) {" + pas["WEBLib.TMSFNCMaps"].LB + "        hoverFeature = ft;" + pas["WEBLib.TMSFNCMaps"].LB + "        " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(event, "MarkerMouseEnter", ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["ID"]));' + pas["WEBLib.TMSFNCMaps"].LB + "      }" + pas["WEBLib.TMSFNCMaps"].LB + "      else if (ft != hoverFeature && hoverFeature === f){" + pas["WEBLib.TMSFNCMaps"].LB + "        hoverFeature = null;" + pas["WEBLib.TMSFNCMaps"].LB + "        " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(event, "MarkerMouseLeave", ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["ID"]));' + pas["WEBLib.TMSFNCMaps"].LB + "      }" + pas["WEBLib.TMSFNCMaps"].LB + "    }" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".on('pointermove', MarkerMouseMove);" + pas["WEBLib.TMSFNCMaps"].LB + "    f.setStyle(iconStyle);" + pas["WEBLib.TMSFNCMaps"].LB + "    var vectorSource = new " + $mod.MAPSERVICEVAR + ".source.Vector({" + pas["WEBLib.TMSFNCMaps"].LB + "      features: [f]" + pas["WEBLib.TMSFNCMaps"].LB + "    });" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].MARKERVAR + " = new " + $mod.MAPSERVICEVAR + ".layer.Vector({" + pas["WEBLib.TMSFNCMaps"].LB + "      source: vectorSource, " + pas["WEBLib.TMSFNCMaps"].LB + "      visible: " + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Visible"],' + pas["WEBLib.TMSFNCMaps"].LB + "      zIndex: 999" + pas["WEBLib.TMSFNCMaps"].LB + "    });" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "    if (" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Draggable"]) {' + pas["WEBLib.TMSFNCMaps"].LB + "      const t = new " + $mod.MAPSERVICEVAR + ".interaction.Translate({" + pas["WEBLib.TMSFNCMaps"].LB + "         features: new " + $mod.MAPSERVICEVAR + ".Collection([f])," + pas["WEBLib.TMSFNCMaps"].LB + "      })" + pas["WEBLib.TMSFNCMaps"].LB + "      t.on('translatestart', e => {" + pas["WEBLib.TMSFNCMaps"].LB + "        if (MarkerPopup){" + pas["WEBLib.TMSFNCMaps"].LB + "          MarkerPopup.setPosition(undefined);" + pas["WEBLib.TMSFNCMaps"].LB + "          MarkerPopup = null;" + pas["WEBLib.TMSFNCMaps"].LB + "        }" + pas["WEBLib.TMSFNCMaps"].LB + "      })" + pas["WEBLib.TMSFNCMaps"].LB + "      t.on('translateend', e => {" + pas["WEBLib.TMSFNCMaps"].LB + "        " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(e, "MarkerDragEnd", ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["ID"]));' + pas["WEBLib.TMSFNCMaps"].LB + "      })" + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".addInteraction(t);" + pas["WEBLib.TMSFNCMaps"].LB + "    }" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].MARKERVAR + ".MarkerClick = MarkerClick;" + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].MARKERVAR + ".MarkerDblClick = MarkerDblClick;" + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].MARKERVAR + ".MarkerMouseUp = MarkerMouseUp;" + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].MARKERVAR + ".MarkerMouseDown = MarkerMouseDown;" + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].MARKERVAR + ".MarkerMouseMove = MarkerMouseMove;" + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".addLayer(" + pas["WEBLib.TMSFNCMaps"].MARKERVAR + ");" + pas["WEBLib.TMSFNCMaps"].LB + "    " + this.GetInitializeEvents() + pas["WEBLib.TMSFNCMaps"].LB + "  }else{" + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].MARKERVAR + ".setVisible(" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Visible"]);' + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].MARKERVAR + ".getSource().getFeatures()[0].setGeometry(loc);" + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].MARKERVAR + ".getSource().getFeatures()[0].setStyle(iconStyle);" + pas["WEBLib.TMSFNCMaps"].LB + "  }";
        return Result;
      };
      this.GetDeleteMarker = function () {
        var Result = "";
        Result = "  " + pas["WEBLib.TMSFNCMaps"].MARKERVAR + ".setSource(null);" + pas["WEBLib.TMSFNCMaps"].LB;
        Result = Result + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".un('click', " + pas["WEBLib.TMSFNCMaps"].MARKERVAR + ".MarkerClick);" + pas["WEBLib.TMSFNCMaps"].LB;
        Result = Result + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".un('dblclick', " + pas["WEBLib.TMSFNCMaps"].MARKERVAR + ".MarkerDblClick);" + pas["WEBLib.TMSFNCMaps"].LB;
        Result = Result + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".un('pointerup', " + pas["WEBLib.TMSFNCMaps"].MARKERVAR + ".MarkerMouseUp);" + pas["WEBLib.TMSFNCMaps"].LB;
        Result = Result + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".un('pointerdown', " + pas["WEBLib.TMSFNCMaps"].MARKERVAR + ".MarkerMouseDown);" + pas["WEBLib.TMSFNCMaps"].LB;
        Result = Result + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".un('pointermove', " + pas["WEBLib.TMSFNCMaps"].MARKERVAR + ".MarkerMouseMove);";
        Result = Result + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".removeLayer(" + pas["WEBLib.TMSFNCMaps"].MARKERVAR + ");" + pas["WEBLib.TMSFNCMaps"].LB;
        return Result;
      };
      this.GetAddOrUpdatePolyElement = function () {
        var Result = "";
        Result = "  var c = " + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["$type"];' + pas["WEBLib.TMSFNCMaps"].LB + "  var vectorStyle;" + pas["WEBLib.TMSFNCMaps"].LB + "  var labelstyle = null;" + pas["WEBLib.TMSFNCMaps"].LB + "  var d;" + pas["WEBLib.TMSFNCMaps"].LB + "  var co = [];" + pas["WEBLib.TMSFNCMaps"].LB + "  var spot;" + "  switch(c){" + pas["WEBLib.TMSFNCMaps"].LB + '    case "TTMSFNCMapsRectangle":' + pas["WEBLib.TMSFNCMaps"].LB + '    case "TTMSFNCMapsOpenLayersRectangle":' + pas["WEBLib.TMSFNCMaps"].LB + "      co.push([" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Bounds"]["SouthWest"]["Longitude"], ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Bounds"]["NorthEast"]["Latitude"]]);' + pas["WEBLib.TMSFNCMaps"].LB + "      co.push([" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Bounds"]["NorthEast"]["Longitude"], ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Bounds"]["NorthEast"]["Latitude"]]);' + pas["WEBLib.TMSFNCMaps"].LB + "      co.push([" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Bounds"]["NorthEast"]["Longitude"], ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Bounds"]["SouthWest"]["Latitude"]]);' + pas["WEBLib.TMSFNCMaps"].LB + "      co.push([" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Bounds"]["SouthWest"]["Longitude"], ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Bounds"]["SouthWest"]["Latitude"]]);' + pas["WEBLib.TMSFNCMaps"].LB + "      co.push([" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Bounds"]["SouthWest"]["Longitude"], ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Bounds"]["NorthEast"]["Latitude"]]);' + pas["WEBLib.TMSFNCMaps"].LB + "    break;" + pas["WEBLib.TMSFNCMaps"].LB + '    case "TTMSFNCMapsCircle":' + pas["WEBLib.TMSFNCMaps"].LB + '    case "TTMSFNCOpenLayersCircle":' + pas["WEBLib.TMSFNCMaps"].LB + "      co = createCircle(" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Center"], ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Radius"], true);' + pas["WEBLib.TMSFNCMaps"].LB + "    break;" + pas["WEBLib.TMSFNCMaps"].LB + "    default:" + pas["WEBLib.TMSFNCMaps"].LB + "      co = " + pas["WEBLib.TMSFNCMaps"].COORDINATEARRAYVAR + ";" + pas["WEBLib.TMSFNCMaps"].LB + "    break;" + pas["WEBLib.TMSFNCMaps"].LB + "  }" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "  switch(c){" + pas["WEBLib.TMSFNCMaps"].LB + '    case "TTMSFNCMapsPolyline":' + pas["WEBLib.TMSFNCMaps"].LB + '    case "TTMSFNCOpenLayersPolyline":' + pas["WEBLib.TMSFNCMaps"].LB + "    d = new " + $mod.MAPSERVICEVAR + ".geom.LineString(co)" + pas["WEBLib.TMSFNCMaps"].LB + "    break;" + pas["WEBLib.TMSFNCMaps"].LB + '    case "TTMSFNCMapsCircle":' + pas["WEBLib.TMSFNCMaps"].LB + '    case "TTMSFNCOpenLayersCircle":' + pas["WEBLib.TMSFNCMaps"].LB + '    case "TTMSFNCMapsRectangle":' + pas["WEBLib.TMSFNCMaps"].LB + '    case "TTMSFNCOpenLayersRectangle":' + pas["WEBLib.TMSFNCMaps"].LB + '    case "TTMSFNCMapsPolygon":' + pas["WEBLib.TMSFNCMaps"].LB + '    case "TTMSFNCOpenLayersPolygon":' + pas["WEBLib.TMSFNCMaps"].LB + "    d = new " + $mod.MAPSERVICEVAR + ".geom.Polygon([co])" + pas["WEBLib.TMSFNCMaps"].LB + "    for (var key in " + pas["WEBLib.TMSFNCMaps"].HOLEARRAYVAR + "){" + pas["WEBLib.TMSFNCMaps"].LB + "      let linear_ring = new " + $mod.MAPSERVICEVAR + ".geom.LinearRing(" + pas["WEBLib.TMSFNCMaps"].HOLEARRAYVAR + "[key]);" + pas["WEBLib.TMSFNCMaps"].LB + "      d.appendLinearRing(linear_ring);" + pas["WEBLib.TMSFNCMaps"].LB + "    }" + pas["WEBLib.TMSFNCMaps"].LB + "    break;" + pas["WEBLib.TMSFNCMaps"].LB + "  }" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "  if ((" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '.hasOwnProperty("Label"))){ ' + pas["WEBLib.TMSFNCMaps"].LB + "    bgFill = new " + $mod.MAPSERVICEVAR + ".style.Fill({color: toRGBA(" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Label"]["BackgroundColor"], 1)});' + pas["WEBLib.TMSFNCMaps"].LB + "    if (" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Label"]["BackgroundColor"] == "gcNull")' + "      bgFill = null;" + pas["WEBLib.TMSFNCMaps"].LB + "    bgStroke = new " + $mod.MAPSERVICEVAR + ".style.Stroke({color: toRGBA(" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Label"]["BorderColor"], 1)});' + pas["WEBLib.TMSFNCMaps"].LB + "    if (" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Label"]["BorderColor"] == "gcNull")' + "      bgStroke = null;" + pas["WEBLib.TMSFNCMaps"].LB + "    labelstyle = " + pas["WEBLib.TMSFNCMaps"].LB + "    new " + $mod.MAPSERVICEVAR + ".style.Text({ " + pas["WEBLib.TMSFNCMaps"].LB + "      fill: new " + $mod.MAPSERVICEVAR + ".style.Fill({color: toRGBA(" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Label"]["FontColor"], 1)}),' + pas["WEBLib.TMSFNCMaps"].LB + "      backgroundFill: bgFill," + pas["WEBLib.TMSFNCMaps"].LB + "      backgroundStroke: bgStroke," + pas["WEBLib.TMSFNCMaps"].LB + "      padding: [" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Label"]["Padding"] + 2, ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Label"]["Padding"], ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Label"]["Padding"], ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Label"]["Padding"]], ' + pas["WEBLib.TMSFNCMaps"].LB + '      placement: "point", ' + pas["WEBLib.TMSFNCMaps"].LB + "      overflow: true, " + pas["WEBLib.TMSFNCMaps"].LB + "      offsetX: " + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Label"]["OffsetX"], ' + pas["WEBLib.TMSFNCMaps"].LB + "      offsetY: " + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Label"]["OffsetY"], ' + pas["WEBLib.TMSFNCMaps"].LB + "      font: " + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Label"]["FontSize"] + "px sans-serif", ' + "      text: " + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Label"]["Text"]' + pas["WEBLib.TMSFNCMaps"].LB + "    });" + pas["WEBLib.TMSFNCMaps"].LB + "  }" + pas["WEBLib.TMSFNCMaps"].LB + "  switch(c){" + pas["WEBLib.TMSFNCMaps"].LB + '    case "TTMSFNCMapsPolyline":' + pas["WEBLib.TMSFNCMaps"].LB + '    case "TTMSFNCOpenLayersPolyline":' + pas["WEBLib.TMSFNCMaps"].LB + "    vectorStyle = new " + $mod.MAPSERVICEVAR + ".style.Style({" + pas["WEBLib.TMSFNCMaps"].LB + "      text: labelstyle, " + pas["WEBLib.TMSFNCMaps"].LB + "      stroke: new " + $mod.MAPSERVICEVAR + ".style.Stroke({" + pas["WEBLib.TMSFNCMaps"].LB + "        color: toRGBA(" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["StrokeColor"], ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["StrokeOpacity"]),' + pas["WEBLib.TMSFNCMaps"].LB + "        width: " + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["StrokeWidth"]' + pas["WEBLib.TMSFNCMaps"].LB + "      })," + pas["WEBLib.TMSFNCMaps"].LB + "    });" + pas["WEBLib.TMSFNCMaps"].LB + "    break;" + pas["WEBLib.TMSFNCMaps"].LB + '    case "TTMSFNCMapsCircle":' + pas["WEBLib.TMSFNCMaps"].LB + '    case "TTMSFNCOpenLayersCircle":' + pas["WEBLib.TMSFNCMaps"].LB + '    case "TTMSFNCMapsRectangle":' + pas["WEBLib.TMSFNCMaps"].LB + '    case "TTMSFNCOpenLayersRectangle":' + pas["WEBLib.TMSFNCMaps"].LB + '    case "TTMSFNCMapsPolygon":' + pas["WEBLib.TMSFNCMaps"].LB + '    case "TTMSFNCOpenLayersPolygon":' + pas["WEBLib.TMSFNCMaps"].LB + "    vectorStyle = new " + $mod.MAPSERVICEVAR + ".style.Style({" + pas["WEBLib.TMSFNCMaps"].LB + "      text: labelstyle, " + pas["WEBLib.TMSFNCMaps"].LB + "      stroke: new " + $mod.MAPSERVICEVAR + ".style.Stroke({" + pas["WEBLib.TMSFNCMaps"].LB + "        color: toRGBA(" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["StrokeColor"], ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["StrokeOpacity"]),' + pas["WEBLib.TMSFNCMaps"].LB + "        width: " + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["StrokeWidth"]' + pas["WEBLib.TMSFNCMaps"].LB + "      })," + pas["WEBLib.TMSFNCMaps"].LB + "      fill: new " + $mod.MAPSERVICEVAR + ".style.Fill({" + pas["WEBLib.TMSFNCMaps"].LB + "        color: toRGBA(" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["FillColor"], ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["FillOpacity"])' + pas["WEBLib.TMSFNCMaps"].LB + "      })" + pas["WEBLib.TMSFNCMaps"].LB + "    });" + pas["WEBLib.TMSFNCMaps"].LB + "    break;" + pas["WEBLib.TMSFNCMaps"].LB + "  }" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "  if (d) {" + pas["WEBLib.TMSFNCMaps"].LB + "    d.transform('EPSG:4326', " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".getView().getProjection());" + pas["WEBLib.TMSFNCMaps"].LB + "  }" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "  if (!" + pas["WEBLib.TMSFNCMaps"].POLYELEMENTVAR + "){" + pas["WEBLib.TMSFNCMaps"].LB + "    var f = new " + $mod.MAPSERVICEVAR + ".Feature({" + pas["WEBLib.TMSFNCMaps"].LB + "      geometry: d" + pas["WEBLib.TMSFNCMaps"].LB + "    })" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "    function getFeature(event){" + pas["WEBLib.TMSFNCMaps"].LB + "      var feature = " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".forEachFeatureAtPixel(event.pixel," + pas["WEBLib.TMSFNCMaps"].LB + "      function(ft) {" + pas["WEBLib.TMSFNCMaps"].LB + "        return ft;" + pas["WEBLib.TMSFNCMaps"].LB + "      }, {" + pas["WEBLib.TMSFNCMaps"].LB + "      layerFilter: function(layer) {" + pas["WEBLib.TMSFNCMaps"].LB + "        return layer === " + pas["WEBLib.TMSFNCMaps"].POLYELEMENTVAR + ";" + pas["WEBLib.TMSFNCMaps"].LB + "      }});" + pas["WEBLib.TMSFNCMaps"].LB + "      return feature;" + pas["WEBLib.TMSFNCMaps"].LB + "    }" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "    var PolyElementClick = function(event){" + pas["WEBLib.TMSFNCMaps"].LB + "      var ft = getFeature(event);" + pas["WEBLib.TMSFNCMaps"].LB + "      if (ft === f && !activePolyElement) {" + pas["WEBLib.TMSFNCMaps"].LB + "        activePolyElement = f;" + pas["WEBLib.TMSFNCMaps"].LB + "        " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(event, "PolyElementClick", ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["ID"]));' + pas["WEBLib.TMSFNCMaps"].LB + "      }" + pas["WEBLib.TMSFNCMaps"].LB + "    }" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".on('click', PolyElementClick);" + pas["WEBLib.TMSFNCMaps"].LB + "    var PolyElementDblClick = function(event){" + pas["WEBLib.TMSFNCMaps"].LB + "      var ft = getFeature(event);" + pas["WEBLib.TMSFNCMaps"].LB + "      if (ft === f && !activePolyElement) {" + pas["WEBLib.TMSFNCMaps"].LB + "        activePolyElement = f;" + pas["WEBLib.TMSFNCMaps"].LB + "        " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(event, "PolyElementDblClick", ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["ID"]));' + pas["WEBLib.TMSFNCMaps"].LB + "      }" + pas["WEBLib.TMSFNCMaps"].LB + "    }" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".on('dblclick', PolyElementDblClick);" + pas["WEBLib.TMSFNCMaps"].LB + "    var PolyElementMouseUp = function(event){" + pas["WEBLib.TMSFNCMaps"].LB + "      var ft = getFeature(event);" + pas["WEBLib.TMSFNCMaps"].LB + "      if (ft === f && !activePolyElement) {" + pas["WEBLib.TMSFNCMaps"].LB + "        activePolyElement = f;" + pas["WEBLib.TMSFNCMaps"].LB + "        " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(event, "PolyElementMouseUp", ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["ID"]));' + pas["WEBLib.TMSFNCMaps"].LB + "      }" + pas["WEBLib.TMSFNCMaps"].LB + "    }" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".on('pointerup', PolyElementMouseUp);" + pas["WEBLib.TMSFNCMaps"].LB + "    var PolyElementMouseDown = function(event){" + pas["WEBLib.TMSFNCMaps"].LB + "      var ft = getFeature(event);" + pas["WEBLib.TMSFNCMaps"].LB + "      if (ft === f && !activePolyElement) {" + pas["WEBLib.TMSFNCMaps"].LB + "        activePolyElement = f;" + pas["WEBLib.TMSFNCMaps"].LB + "        " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(event, "PolyElementMouseDown", ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["ID"]));' + pas["WEBLib.TMSFNCMaps"].LB + "      }" + pas["WEBLib.TMSFNCMaps"].LB + "    }" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".on('pointerdown', PolyElementMouseDown);" + pas["WEBLib.TMSFNCMaps"].LB + "    var PolyElementMouseMove = function(event){" + pas["WEBLib.TMSFNCMaps"].LB + "      var ft = getFeature(event);" + pas["WEBLib.TMSFNCMaps"].LB + "      if (ft && ft === f && ft != hoverFeature) {" + pas["WEBLib.TMSFNCMaps"].LB + "        hoverFeature = ft;" + pas["WEBLib.TMSFNCMaps"].LB + "        " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(event, "PolyElementMouseEnter", ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["ID"]));' + pas["WEBLib.TMSFNCMaps"].LB + "      }" + pas["WEBLib.TMSFNCMaps"].LB + "      else if (ft != hoverFeature && hoverFeature === f){" + pas["WEBLib.TMSFNCMaps"].LB + "        hoverFeature = null;" + pas["WEBLib.TMSFNCMaps"].LB + "        " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(event, "PolyElementMouseLeave", ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["ID"]));' + pas["WEBLib.TMSFNCMaps"].LB + "      }" + pas["WEBLib.TMSFNCMaps"].LB + "    }" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".on('pointermove', PolyElementMouseMove);" + pas["WEBLib.TMSFNCMaps"].LB + "  var vectorSource = new " + $mod.MAPSERVICEVAR + ".source.Vector({" + pas["WEBLib.TMSFNCMaps"].LB + "    features: [f]" + pas["WEBLib.TMSFNCMaps"].LB + "  });" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].POLYELEMENTVAR + " = new " + $mod.MAPSERVICEVAR + ".layer.Vector({" + pas["WEBLib.TMSFNCMaps"].LB + "    source: vectorSource," + pas["WEBLib.TMSFNCMaps"].LB + "    style: vectorStyle," + pas["WEBLib.TMSFNCMaps"].LB + "    visible: " + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Visible"]' + pas["WEBLib.TMSFNCMaps"].LB + "  });" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "    if (" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Draggable"]) {' + pas["WEBLib.TMSFNCMaps"].LB + "      const t = new " + $mod.MAPSERVICEVAR + ".interaction.Translate({" + pas["WEBLib.TMSFNCMaps"].LB + "         features: new " + $mod.MAPSERVICEVAR + ".Collection([f])," + pas["WEBLib.TMSFNCMaps"].LB + "      })" + pas["WEBLib.TMSFNCMaps"].LB + "      t.on('translateend', e => {" + pas["WEBLib.TMSFNCMaps"].LB + "        " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(e, "PolyElementDragEnd", ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["ID"]));' + pas["WEBLib.TMSFNCMaps"].LB + "      })" + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".addInteraction(t);" + pas["WEBLib.TMSFNCMaps"].LB + "    }" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].POLYELEMENTVAR + ".PolyElementClick = PolyElementClick;" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].POLYELEMENTVAR + ".PolyElementDblClick = PolyElementDblClick;" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].POLYELEMENTVAR + ".PolyElementMouseUp = PolyElementMouseUp;" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].POLYELEMENTVAR + ".PolyElementMouseDown = PolyElementMouseDown;" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].POLYELEMENTVAR + ".PolyElementMouseMove = PolyElementMouseMove;" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".addLayer(" + pas["WEBLib.TMSFNCMaps"].POLYELEMENTVAR + ");" + pas["WEBLib.TMSFNCMaps"].LB + "    " + this.GetInitializeEvents() + pas["WEBLib.TMSFNCMaps"].LB + "  }else{" + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].POLYELEMENTVAR + ".setVisible(" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Visible"]);' + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].POLYELEMENTVAR + ".getSource().getFeatures()[0].setGeometry(d);" + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].POLYELEMENTVAR + ".setStyle(vectorStyle);" + pas["WEBLib.TMSFNCMaps"].LB + "  }";
        return Result;
      };
      this.GetDeletePolyElement = function () {
        var Result = "";
        Result = "  " + pas["WEBLib.TMSFNCMaps"].POLYELEMENTVAR + ".setSource(null);" + pas["WEBLib.TMSFNCMaps"].LB;
        Result = Result + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".un('click', " + pas["WEBLib.TMSFNCMaps"].POLYELEMENTVAR + ".PolyElementClick);" + pas["WEBLib.TMSFNCMaps"].LB;
        Result = Result + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".un('dblclick', " + pas["WEBLib.TMSFNCMaps"].POLYELEMENTVAR + ".PolyElementDblClick);" + pas["WEBLib.TMSFNCMaps"].LB;
        Result = Result + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".un('pointerup', " + pas["WEBLib.TMSFNCMaps"].POLYELEMENTVAR + ".PolyElementMouseUp);" + pas["WEBLib.TMSFNCMaps"].LB;
        Result = Result + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".un('pointerdown', " + pas["WEBLib.TMSFNCMaps"].POLYELEMENTVAR + ".PolyElementMouseDown);" + pas["WEBLib.TMSFNCMaps"].LB;
        Result = Result + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".un('pointermove', " + pas["WEBLib.TMSFNCMaps"].POLYELEMENTVAR + ".PolyElementMouseMove);";
        Result = Result + "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".removeLayer(" + pas["WEBLib.TMSFNCMaps"].POLYELEMENTVAR + ");" + pas["WEBLib.TMSFNCMaps"].LB;
        return Result;
      };
      this.GetZoomToBounds = function () {
        var Result = "";
        Result = "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".getView().fit(" + $mod.MAPSERVICEVAR + ".proj.transformExtent([" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["SouthWest"]["Longitude"],' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["SouthWest"]["Latitude"],' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["NorthEast"]["Longitude"],' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["NorthEast"]["Latitude"]], \'EPSG:4326\', ' + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".getView().getProjection()), { size: " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".getSize() })";
        return Result;
      };
      this.GetGetBounds = function () {
        var Result = "";
        Result = "  var loc = " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".getView().calculateExtent();" + pas["WEBLib.TMSFNCMaps"].LB + "  var l = " + $mod.MAPSERVICEVAR + ".proj.transformExtent(loc, " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".getView().getProjection(), 'EPSG:4326');" + pas["WEBLib.TMSFNCMaps"].LB + '  jsonObj["NorthEast"]["Latitude"] = l[3];' + pas["WEBLib.TMSFNCMaps"].LB + '  jsonObj["NorthEast"]["Longitude"] = l[2];' + pas["WEBLib.TMSFNCMaps"].LB + '  jsonObj["SouthWest"]["Latitude"] = l[1];' + pas["WEBLib.TMSFNCMaps"].LB + '  jsonObj["SouthWest"]["Longitude"] = l[0];';
        return Result;
      };
      this.GetGetCenterCoordinate = function () {
        var Result = "";
        Result = "  var loc = " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".getView().getCenter();" + pas["WEBLib.TMSFNCMaps"].LB + "  var l = " + $mod.MAPSERVICEVAR + ".proj.transform(loc, " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".getView().getProjection(), 'EPSG:4326');" + pas["WEBLib.TMSFNCMaps"].LB + '  jsonObj["Latitude"] = l[1];' + pas["WEBLib.TMSFNCMaps"].LB + '  jsonObj["Longitude"] = l[0];';
        return Result;
      };
      this.GetGetZoomLevel = function () {
        var Result = "";
        Result = "  var z = " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".getView().getZoom();";
        return Result;
      };
      this.GetLatLonToXY = function () {
        var Result = "";
        Result = "  var coordinate = " + $mod.MAPSERVICEVAR + ".proj.fromLonLat([parseFloat(" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Longitude"]), parseFloat(' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Latitude"])]);' + pas["WEBLib.TMSFNCMaps"].LB + "  var pixel = " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".getPixelFromCoordinate(coordinate);" + pas["WEBLib.TMSFNCMaps"].LB + '  jsonObj["X"] = parseFloat(pixel[0]);' + pas["WEBLib.TMSFNCMaps"].LB + '  jsonObj["Y"] = parseFloat(pixel[1]);';
        return Result;
      };
      this.GetXYToLatLon = function () {
        var Result = "";
        Result = "";
        return Result;
      };
      this.GetSetCenterCoordinate = function () {
        var Result = "";
        Result = "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".getView().setCenter(" + $mod.MAPSERVICEVAR + ".proj.fromLonLat([" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Longitude"], ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Latitude"]]));';
        return Result;
      };
      this.GetSetZoomLevel = function () {
        var Result = "";
        Result = "  " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".getView().setZoom(" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + ");";
        return Result;
      };
      this.GetUpdateOptions = function () {
        var Result = "";
        Result = Result + "  " + $impl.MAPCONTROLARRAYVAR + ".forEach(removeElement);" + pas["WEBLib.TMSFNCMaps"].LB + "  function removeElement(value){" + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".removeControl(value);" + pas["WEBLib.TMSFNCMaps"].LB + "  }" + pas["WEBLib.TMSFNCMaps"].LB + "  " + $impl.MAPCONTROLARRAYVAR + " = [];" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB;
        Result = Result + "  " + $impl.MAPDOUBLECLICK + ".setActive(" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["ZoomOnDblClick"]);' + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB;
        Result = Result + "  " + $impl.MAPPANNING + ".setActive(" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Panning"]);' + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB;
        Result = Result + "  " + $impl.MAPWHEELZOOM + ".setActive(" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["ZoomOnWheelScroll"]);' + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB;
        Result = Result + "  if (" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["ShowZoomControl"]){' + pas["WEBLib.TMSFNCMaps"].LB + "    " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".addControl(" + $impl.MAPZOOMCONTROLVAR + ");" + pas["WEBLib.TMSFNCMaps"].LB + "    " + $impl.MAPCONTROLARRAYVAR + ".push(" + $impl.MAPZOOMCONTROLVAR + ");" + pas["WEBLib.TMSFNCMaps"].LB + "  }";
        return Result;
      };
      this.GetGlobalVariables = function () {
        var Result = "";
        Result = "var activePolyElement = null;" + pas["WEBLib.TMSFNCMaps"].LB + "var activeMarker = null;" + pas["WEBLib.TMSFNCMaps"].LB + "var " + $impl.MAPZOOMCONTROLVAR + ";" + pas["WEBLib.TMSFNCMaps"].LB + "var " + $impl.MAPCONTROLARRAYVAR + " = [];" + "var oldZoom;" + pas["WEBLib.TMSFNCMaps"].LB + "var hoverFeature;" + pas["WEBLib.TMSFNCMaps"].LB + "var mouseLatLng = {'Latitude': 0, 'Longitude': 0};" + pas["WEBLib.TMSFNCMaps"].LB + "function parseEvent(event, eventname, id = ''){" + pas["WEBLib.TMSFNCMaps"].LB + "  var loc = {'Latitude': 0, 'Longitude': 0};" + pas["WEBLib.TMSFNCMaps"].LB + "  var x = 0.0;" + pas["WEBLib.TMSFNCMaps"].LB + "  var y = 0.0;" + pas["WEBLib.TMSFNCMaps"].LB + '  if ((eventname == "MapMoveStart") || (eventname == "MapMoveEnd")){ ' + "    centerpt = " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".getView().getCenter();" + pas["WEBLib.TMSFNCMaps"].LB + "    var l = " + $mod.MAPSERVICEVAR + ".proj.transform(centerpt, " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".getView().getProjection(), 'EPSG:4326');" + pas["WEBLib.TMSFNCMaps"].LB + "    loc = {'Latitude': l[1], 'Longitude': l[0]};" + pas["WEBLib.TMSFNCMaps"].LB + "  } else if (event) {" + pas["WEBLib.TMSFNCMaps"].LB + "    if (event.coordinate){" + pas["WEBLib.TMSFNCMaps"].LB + "      var l = " + $mod.MAPSERVICEVAR + ".proj.transform(event.coordinate, " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".getView().getProjection(), 'EPSG:4326');" + pas["WEBLib.TMSFNCMaps"].LB + "      loc = {'Latitude': l[1], 'Longitude': l[0]};" + pas["WEBLib.TMSFNCMaps"].LB + "      mouseLatLng = loc;" + pas["WEBLib.TMSFNCMaps"].LB + "    }" + pas["WEBLib.TMSFNCMaps"].LB + "    if (event.pixel){" + pas["WEBLib.TMSFNCMaps"].LB + "      x = event.pixel[0];" + pas["WEBLib.TMSFNCMaps"].LB + "      y = event.pixel[1];" + pas["WEBLib.TMSFNCMaps"].LB + "    }" + pas["WEBLib.TMSFNCMaps"].LB + "  }" + pas["WEBLib.TMSFNCMaps"].LB + "  var r = {'Coordinate': loc, 'X': x, 'Y': y, 'ID': id, 'EventName': eventname};" + pas["WEBLib.TMSFNCMaps"].LB + "  return r;" + pas["WEBLib.TMSFNCMaps"].LB + "}" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "function ZoomChanged(){" + pas["WEBLib.TMSFNCMaps"].LB + "    if (" + pas["WEBLib.TMSFNCMaps"].MAPVAR + "){" + pas["WEBLib.TMSFNCMaps"].LB + "      if (!oldZoom){" + pas["WEBLib.TMSFNCMaps"].LB + "        oldZoom = " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".getView().getZoom();" + pas["WEBLib.TMSFNCMaps"].LB + "      }" + pas["WEBLib.TMSFNCMaps"].LB + "      var newZoom = " + pas["WEBLib.TMSFNCMaps"].MAPVAR + ".getView().getZoom();" + pas["WEBLib.TMSFNCMaps"].LB + "      if(newZoom != oldZoom){" + pas["WEBLib.TMSFNCMaps"].LB + "        " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(null, "ZoomChanged"));' + pas["WEBLib.TMSFNCMaps"].LB + "      }" + pas["WEBLib.TMSFNCMaps"].LB + "      oldZoom = newZoom;" + pas["WEBLib.TMSFNCMaps"].LB + "    }" + pas["WEBLib.TMSFNCMaps"].LB + "  }" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "function ResetActive(){" + pas["WEBLib.TMSFNCMaps"].LB + "  if (activeMarker){" + pas["WEBLib.TMSFNCMaps"].LB + "    activeMarker = null;" + pas["WEBLib.TMSFNCMaps"].LB + "    return true;" + pas["WEBLib.TMSFNCMaps"].LB + "  }" + pas["WEBLib.TMSFNCMaps"].LB + "  if (activePolyElement){" + pas["WEBLib.TMSFNCMaps"].LB + "    activePolyElement = null;" + pas["WEBLib.TMSFNCMaps"].LB + "    return true;" + pas["WEBLib.TMSFNCMaps"].LB + "  }" + pas["WEBLib.TMSFNCMaps"].LB + "  return false;" + pas["WEBLib.TMSFNCMaps"].LB + "}" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "function MapMoveStart(event){" + pas["WEBLib.TMSFNCMaps"].LB + "  if (ResetActive()){" + pas["WEBLib.TMSFNCMaps"].LB + "    return;" + pas["WEBLib.TMSFNCMaps"].LB + "  }" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(event, "MapMoveStart"));' + pas["WEBLib.TMSFNCMaps"].LB + "}" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "function MapMoveEnd(event){" + pas["WEBLib.TMSFNCMaps"].LB + "  if (ResetActive()){" + pas["WEBLib.TMSFNCMaps"].LB + "    return;" + pas["WEBLib.TMSFNCMaps"].LB + "  }" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(event, "MapMoveEnd"));' + pas["WEBLib.TMSFNCMaps"].LB + "}" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "function MapClick(event){" + pas["WEBLib.TMSFNCMaps"].LB + "  if (ResetActive()){" + pas["WEBLib.TMSFNCMaps"].LB + "    return;" + pas["WEBLib.TMSFNCMaps"].LB + "  }" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(event, "MapClick"));' + pas["WEBLib.TMSFNCMaps"].LB + "}" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "function MapDblClick(event){" + pas["WEBLib.TMSFNCMaps"].LB + "  if (ResetActive()){" + pas["WEBLib.TMSFNCMaps"].LB + "    return;" + pas["WEBLib.TMSFNCMaps"].LB + "  }" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(event, "MapDblClick"));' + pas["WEBLib.TMSFNCMaps"].LB + "}" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "function MapMouseDown(event){" + pas["WEBLib.TMSFNCMaps"].LB + "  if (ResetActive()){" + pas["WEBLib.TMSFNCMaps"].LB + "    return;" + pas["WEBLib.TMSFNCMaps"].LB + "  }" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(event, "MapMouseDown"));' + pas["WEBLib.TMSFNCMaps"].LB + "}" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "function MapMouseUp(event){" + pas["WEBLib.TMSFNCMaps"].LB + "  if (ResetActive()){" + pas["WEBLib.TMSFNCMaps"].LB + "    return;" + pas["WEBLib.TMSFNCMaps"].LB + "  }" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(event, "MapMouseUp"));' + pas["WEBLib.TMSFNCMaps"].LB + "}" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "function MapMouseLeave(event){" + pas["WEBLib.TMSFNCMaps"].LB + "  if (ResetActive()){" + pas["WEBLib.TMSFNCMaps"].LB + "    return;" + pas["WEBLib.TMSFNCMaps"].LB + "  }" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(event, "MapMouseLeave"));' + pas["WEBLib.TMSFNCMaps"].LB + "}" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "function MapMouseEnter(event){" + pas["WEBLib.TMSFNCMaps"].LB + "  if (ResetActive()){" + pas["WEBLib.TMSFNCMaps"].LB + "    return;" + pas["WEBLib.TMSFNCMaps"].LB + "  }" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(event, "MapMousEnter"));' + pas["WEBLib.TMSFNCMaps"].LB + "}" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "function MapMouseMove(event){" + pas["WEBLib.TMSFNCMaps"].LB + "  if (ResetActive()){" + pas["WEBLib.TMSFNCMaps"].LB + "    return;" + pas["WEBLib.TMSFNCMaps"].LB + "  }" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(event, "MapMouseMove"));' + pas["WEBLib.TMSFNCMaps"].LB + "}" + pas["WEBLib.TMSFNCMaps"].LB + pas["WEBLib.TMSFNCMaps"].LB + "function MapRenderComplete(event){" + pas["WEBLib.TMSFNCMaps"].LB + "  if (ResetActive()){" + pas["WEBLib.TMSFNCMaps"].LB + "    return;" + pas["WEBLib.TMSFNCMaps"].LB + "  }" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].GETSENDEVENT + '(parseEvent(event, "MapRenderComplete"));' + pas["WEBLib.TMSFNCMaps"].LB + "}" + pas["WEBLib.TMSFNCMaps"].LB;
        Result = Result + "var " + $mod.CLUSTERVAR + ";" + pas["WEBLib.TMSFNCMaps"].LB + "var " + $mod.CLUSTERARRAYVAR + " = {};" + pas["WEBLib.TMSFNCMaps"].LB + "function " + $mod.GETCLUSTERARRAYVAR + "{" + pas["WEBLib.TMSFNCMaps"].LB + "  var arr = [];" + pas["WEBLib.TMSFNCMaps"].LB + "  for (var key in " + $mod.CLUSTERARRAYVAR + "){" + pas["WEBLib.TMSFNCMaps"].LB + "    var v = key;" + pas["WEBLib.TMSFNCMaps"].LB + "    arr.push(v);" + pas["WEBLib.TMSFNCMaps"].LB + "  }" + pas["WEBLib.TMSFNCMaps"].LB + "  return arr.toString();" + pas["WEBLib.TMSFNCMaps"].LB + "}";
        return Result;
      };
      this.GetAddCoordinateToArray = function () {
        var Result = "";
        Result = "  " + pas["WEBLib.TMSFNCMaps"].COORDINATEARRAYVAR + ".push([" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Longitude"],' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '["Latitude"]]);';
        return Result;
      };
      this.GetAddHoleToArray = function () {
        var Result = "";
        Result = "var o = " + pas["WEBLib.TMSFNCMaps"].HOLEARRAYVAR + "[" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + "[0]];" + pas["WEBLib.TMSFNCMaps"].LB + "if (o){" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].HOLEARRAYVAR + "[" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + "[0]].push([" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '[1]["Longitude"], ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '[1]["Latitude"]]);' + pas["WEBLib.TMSFNCMaps"].LB + "}else{" + pas["WEBLib.TMSFNCMaps"].LB + "  " + pas["WEBLib.TMSFNCMaps"].HOLEARRAYVAR + "[" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + "[0]] = [[" + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '[1]["Longitude"], ' + pas["WEBLib.TMSFNCMaps"].PARAMSNAME + '[1]["Latitude"]]];' + pas["WEBLib.TMSFNCMaps"].LB + "}";
        return Result;
      };
      this.GetInitializeCoordinateArray = function () {
        var Result = "";
        Result = "[]";
        return Result;
      };
      this.GetInitializeHolesArray = function () {
        var Result = "";
        Result = "[]";
        return Result;
      };
      this.IsValid = function () {
        var Result = false;
        Result = true;
        return Result;
      };
      this.DestroyMaps = function () {
        var $ir = rtl.createIntfRefs();
        try {
          $impl.MapsService.DestroyMaps($ir.ref(1,rtl.queryIntfT(this,pas["WEBLib.TMSFNCMaps"].ITMSFNCCustomMaps)));
        } finally {
          $ir.free();
        };
      };
      this.Create$1 = function () {
        pas.System.TObject.Create.call(this);
        return this;
      };
      this.Destroy = function () {
        pas["WEBLib.TMSFNCMaps"].TTMSFNCCustomMapsInterfacedObject.Destroy.call(this);
      };
      rtl.addIntf(this,pas["WEBLib.TMSFNCMaps"].ITMSFNCCustomMaps);
      rtl.addIntf(this,pas["WEBLib.TMSFNCMaps"].ITMSFNCCustomMapsInstance);
      rtl.addIntf(this,pas.System.IUnknown);
    });
    $impl.MapsService = null;
    $impl.MAPZOOMCONTROLVAR = "mapZoomControl";
    $impl.MAPCONTROLARRAYVAR = "mapControls";
    $impl.MAPDOUBLECLICK = "mapDoubleClick";
    $impl.MAPWHEELZOOM = "mapWheelZoom";
    $impl.MAPPANNING = "mapPanning";
  };
},["Classes","Math","DateUtils","Types","SysUtils","WEBLib.TMSFNCMaps","WEBLib.TMSFNCUtils","WEBLib.TMSFNCTypes","WEBLib.TMSFNCMapsCommonTypes","contnrs","Web"]);
//# sourceMappingURL=WEBLib.TMSFNCMaps.OpenLayers.js.map
